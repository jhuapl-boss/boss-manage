@startuml

header Last updated 03Feb2020
footer Generated from ingest-job-states.uml by PlantUML
title Ingest Job States

state Normal {
[*] --> PREPARING

PREPARING -> UPLOADING : upload queue populated

UPLOADING -> WAIT_ON_QUEUES : complete req

WAIT_ON_QUEUES : Sets timestamp in DB on first complete req
WAIT_ON_QUEUES --> COMPLETING : complete req && queues empty after n secs
WAIT_ON_QUEUES -> UPLOADING : upload queue not empty

COMPLETING -> COMPLETE : all complete steps done
}

Normal --> Error
Normal --> Delete : cancel request

state Error {
[*] --> FAILED
}

Error --> Delete : cancel request

state Delete {
[*] --> DELETED
}


@enduml
